<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TKC方式 | 自計化×自動化 効果試算アプリ（r5）</title>
  <style>
    :root {
      --bg: #f7f9fc;
      --card: #ffffff;
      --ink: #0f172a;
      --muted: #64748b;
      --accent: #2563eb;
      --good: #059669;
      --warn: #b45309;
      --ring: rgba(37, 99, 235, .15);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Yu Gothic", "Noto Sans JP", sans-serif; margin: 0; color: var(--ink); background: var(--bg); }
    .wrap { max-width: 1000px; margin: 24px auto 64px; padding: 0 16px; }

    header { margin-bottom: 16px; }
    h1 { font-size: clamp(20px, 3.5vw, 28px); margin: 0 0 6px; }
    .sub { color: var(--muted); font-size: 13px; }

    .card { background: var(--card); border-radius: var(--radius); box-shadow: 0 1px 2px rgba(15,23,42,.06), 0 8px 24px rgba(2,6,23,.08); padding: 16px; margin: 12px 0; }
    .grid { display: grid; gap: 12px; grid-template-columns: repeat(12, 1fr); align-items: end; }

    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    input[type="number"], input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #e5e7eb; background: #fff; font-size: 14px; outline: none; }
    input[type="number"]:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }

    .row { display: contents; }
    .th, .td { padding: 10px 8px; }
    .thead { color: var(--muted); font-size: 12px; font-weight: 600; border-bottom: 1px solid #eef2f7; }
    .td.res { text-align: right; font-variant-numeric: tabular-nums; }

    .note { font-size: 12px; color: var(--muted); }
    .muted { color: var(--muted); }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button { cursor: pointer; border: none; border-radius: 12px; padding: 10px 14px; font-size: 14px; }
    .primary { background: var(--accent); color: #fff; }
    .ghost { background: #eef2ff; color: #1e3a8a; }
    .outline { background: #fff; border: 1px solid #e5e7eb; }

    .kpi { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .kpi .item { background: #fff; border: 1px dashed #e2e8f0; border-radius: 12px; padding: 14px; }
    .kpi h3 { margin: 0 0 6px; font-size: 12px; color: var(--muted); }
    .kpi .val { font-size: clamp(18px, 3.2vw, 24px); font-variant-numeric: tabular-nums; }
    .pos { color: var(--good); }
    .warn { color: var(--warn); }

    .sumline { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: #f1f5f9; border-radius: 10px; font-size: 13px; }

    footer { margin-top: 20px; color: var(--muted); font-size: 12px; }

    @media (max-width: 720px) {
      .grid { gap: 8px; }
      .kpi { grid-template-columns: 1fr; }
      .thead { display: none; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px 8px; border-bottom: 1px solid #eef2f7; }
      .row .td.res { grid-column: 1 / -1; text-align: right; }
    }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>自計化×自動化の効果試算（TKC方式）</h1>
      <div class="sub">前提を入力すると、<strong>月間の時間短縮・人件費削減</strong>、および<strong>FXシリーズ基本料金</strong>を考慮したネット効果を算出します。削減率は使わず、<strong>1件あたりの作業時間（分）</strong>を前後で直接入力します。</div>
    </header>

    <!-- 0) グローバル前提  -->
    <section class="card">
      <div class="grid" style="grid-template-columns: repeat(12, 1fr);">
        <div class="th thead" style="grid-column: span 12;">試算前提</div>
        <div class="td" style="grid-column: span 4;">
          <label>FXシリーズ基本料金（<span class="muted">月額・円</span>）</label>
          <input id="fxFee" type="number" inputmode="decimal" placeholder="例：15000" min="0" />
        </div>
        <div class="td" style="grid-column: span 4;">
          <label>人件費単価（<span class="muted">円/時・社保等込み</span>）</label>
          <input id="wage" type="number" inputmode="decimal" placeholder="例：3000" min="0" />
        </div>
        <div class="td" style="grid-column: span 4;">
          <label>月間仕訳数（<span class="muted">総数</span>）</label>
          <input id="totalJournals" type="number" inputmode="numeric" value="320" min="0" />
        </div>
      </div>
      <div class="note" style="margin-top:8px;">※ 時間は社内の実測値で置き換えてください（例：証憑読取の前後差、銀行データ自動仕訳の前後差など）。</div>
    </section>

    <!-- 1) 機能別入力 -->
    <section class="card">
      <div class="thead grid" style="grid-template-columns: 3fr 2fr 3fr 3fr 1fr;">
        <div class="th">機能</div>
        <div class="th">件数（/月）</div>
        <div class="th">1件あたり 手作業（分）</div>
        <div class="th">1件あたり 自動化後（分）</div>
        <div class="th" style="text-align:right;">削減h</div>
      </div>

      <div class="grid" style="grid-template-columns: 3fr 2fr 3fr 3fr 1fr;" id="rows">
        <!-- 証憑保存 -->
        <div class="td">証憑保存（スマホで経費）</div>
        <div class="td"><input id="n_receipts" type="number" value="30" min="0"/></div>
        <div class="td"><input id="t_receipts_before" type="number" placeholder="例：3" min="0"/></div>
        <div class="td"><input id="t_receipts_after" type="number" placeholder="例：1" min="0"/></div>
        <div class="td res" id="h_receipts">0.00</div>

        <!-- 銀行・信販データ受信 -->
        <div class="td">銀行・信販データ受信</div>
        <div class="td"><input id="n_bank" type="number" value="260" min="0"/></div>
        <div class="td"><input id="t_bank_before" type="number" placeholder="例：2" min="0"/></div>
        <div class="td"><input id="t_bank_after" type="number" placeholder="例：0.5" min="0"/></div>
        <div class="td res" id="h_bank">0.00</div>

        <!-- 給与計算 -->
        <div class="td">給与計算（仕訳含む）</div>
        <div class="td"><input id="n_payroll" type="number" value="10" min="0"/></div>
        <div class="td"><input id="t_payroll_before" type="number" placeholder="例：8" min="0"/></div>
        <div class="td"><input id="t_payroll_after" type="number" placeholder="例：3" min="0"/></div>
        <div class="td res" id="h_payroll">0.00</div>

        <!-- 販売管理 -->
        <div class="td">販売管理（売上計上・請求）</div>
        <div class="td"><input id="n_sales" type="number" value="12" min="0"/></div>
        <div class="td"><input id="t_sales_before" type="number" placeholder="例：10" min="0"/></div>
        <div class="td"><input id="t_sales_after" type="number" placeholder="例：4" min="0"/></div>
        <div class="td res" id="h_sales">0.00</div>
      </div>

      <div class="sumline" id="sumline">
        <div>モジュール件数合計：<strong id="sumCount">312</strong>（目標：<span id="targetCount">320</span>）</div>
        <div id="deltaMsg" class="muted"></div>
      </div>

      <div class="btns" style="margin-top:12px;">
        <button class="primary" id="calcBtn">効果を計算</button>
        <button class="outline" id="resetBtn">リセット</button>
      </div>
    </section>

    <!-- 2) 結果表示 -->
    <section class="card">
      <div class="kpi">
        <div class="item">
          <h3>時間短縮（合計・月間）</h3>
          <div class="val" id="kpiHours">0.00 時間</div>
          <div class="note">※ （手作業−自動化）×件数 の合計（/60）</div>
        </div>
        <div class="item">
          <h3>人件費削減（合計・月間）</h3>
          <div class="val pos" id="kpiYen">¥0</div>
          <div class="note">時給 × 時間短縮</div>
        </div>
        <div class="item">
          <h3>ネット効果（<span class="muted">月間</span>）</h3>
          <div class="val" id="kpiNet">¥0</div>
          <div class="note">人件費削減 − FX基本料金</div>
        </div>
        <div class="item">
          <h3>ネット効果（<span class="muted">年間</span>）</h3>
          <div class="val" id="kpiNetYear">¥0</div>
          <div class="note">ネット効果（月間）×12</div>
        </div>
      </div>
    </section>

    <!-- 3) チェックポイント -->
    <section class="card">
      <strong>ステップバック・クエスチョン（前提の確認）</strong>
      <ul class="note" style="margin:8px 0 0 16px; line-height:1.8;">
        <li>人件費単価は<span class="muted">法定福利費・賞与按分・間接時間</span>を含む「実効時給」ですか？（含まない場合、実効時給に引き上げ推奨）</li>
        <li>時間は誰の作業時間ですか？（所内/顧問先）双方の削減を分けて評価する必要はありませんか？</li>
        <li>自動化後の残作業（例：例外仕訳、承認、チェック）は反映されていますか？</li>
        <li>販売管理・給与は「件数」よりも「締め回数×担当者数」で表した方が正確ではありませんか？</li>
        <li>FXシリーズ以外の追加費用（スマホで経費オプション等）がある場合、別途差し引きが必要です。</li>
      </ul>
    </section>

    <footer>
      v r5 · 作成: ChatGPT（TKC方式 内部試算用） · このツールは社内実測値の入力を前提としています。
    </footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const yen = (n) => n.toLocaleString('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 });

    const ids = {
      fxFee: 'fxFee', wage: 'wage', totalJournals: 'totalJournals',
      n_receipts: 'n_receipts', t_receipts_before: 't_receipts_before', t_receipts_after: 't_receipts_after',
      n_bank: 'n_bank', t_bank_before: 't_bank_before', t_bank_after: 't_bank_after',
      n_payroll: 'n_payroll', t_payroll_before: 't_payroll_before', t_payroll_after: 't_payroll_after',
      n_sales: 'n_sales', t_sales_before: 't_sales_before', t_sales_after: 't_sales_after'
    };

    function getNum(id) {
      const v = parseFloat($(id).value);
      return isNaN(v) ? 0 : v;
    }

    function rowHours(n, tBefore, tAfter) {
      const diffMin = Math.max(0, (tBefore - tAfter));
      return (diffMin * n) / 60; // hours
    }

    function sumCounts() {
      const sum = getNum(ids.n_receipts) + getNum(ids.n_bank) + getNum(ids.n_payroll) + getNum(ids.n_sales);
      $('sumCount').textContent = sum.toString();
      const target = getNum(ids.totalJournals);
      $('targetCount').textContent = target.toString();
      const delta = sum - target;
      const msg = delta === 0 ? 'OK：件数は総数と一致しています。' : (delta > 0 ? `注意：総数を ${delta} 件超過` : `注意：総数に ${Math.abs(delta)} 件不足`);
      const deltaMsg = $('deltaMsg');
      deltaMsg.textContent = msg;
      deltaMsg.style.color = delta === 0 ? 'var(--good)' : 'var(--warn)';
    }

    function calc() {
      // per row
      const h_receipts = rowHours(getNum(ids.n_receipts), getNum(ids.t_receipts_before), getNum(ids.t_receipts_after));
      const h_bank     = rowHours(getNum(ids.n_bank),     getNum(ids.t_bank_before),     getNum(ids.t_bank_after));
      const h_payroll  = rowHours(getNum(ids.n_payroll),  getNum(ids.t_payroll_before),  getNum(ids.t_payroll_after));
      const h_sales    = rowHours(getNum(ids.n_sales),    getNum(ids.t_sales_before),    getNum(ids.t_sales_after));

      $('h_receipts').textContent = h_receipts.toFixed(2);
      $('h_bank').textContent     = h_bank.toFixed(2);
      $('h_payroll').textContent  = h_payroll.toFixed(2);
      $('h_sales').textContent    = h_sales.toFixed(2);

      const totalH = h_receipts + h_bank + h_payroll + h_sales;
      $('kpiHours').textContent = `${totalH.toFixed(2)} 時間`;

      const wage = getNum(ids.wage);
      const fxFee = getNum(ids.fxFee);

      const monthlySaving = totalH * wage; // 円
      $('kpiYen').textContent = yen(monthlySaving);

      const net = monthlySaving - fxFee;
      $('kpiNet').textContent = yen(net);
      $('kpiNet').style.color = net >= 0 ? 'var(--good)' : 'var(--warn)';

      const netYear = net * 12;
      $('kpiNetYear').textContent = yen(netYear);

      sumCounts();
    }

    function reset() {
      // Keep default counts; clear the rest
      $(ids.fxFee).value = '';
      $(ids.wage).value = '';
      $(ids.totalJournals).value = 320;

      $(ids.n_receipts).value = 30;
      $(ids.t_receipts_before).value = '';
      $(ids.t_receipts_after).value = '';

      $(ids.n_bank).value = 260;
      $(ids.t_bank_before).value = '';
      $(ids.t_bank_after).value = '';

      $(ids.n_payroll).value = 10;
      $(ids.t_payroll_before).value = '';
      $(ids.t_payroll_after).value = '';

      $(ids.n_sales).value = 12;
      $(ids.t_sales_before).value = '';
      $(ids.t_sales_after).value = '';

      ['h_receipts','h_bank','h_payroll','h_sales'].forEach(id => $(id).textContent = '0.00');
      $('kpiHours').textContent = '0.00 時間';
      $('kpiYen').textContent = '¥0';
      $('kpiNet').textContent = '¥0';
      $('kpiNet').style.color = 'inherit';
      $('kpiNetYear').textContent = '¥0';
      sumCounts();
    }

    // Wire up
    $('calcBtn').addEventListener('click', calc);
    $('resetBtn').addEventListener('click', reset);

    // live updates for counts/targets
    [ids.n_receipts, ids.n_bank, ids.n_payroll, ids.n_sales, ids.totalJournals].forEach(id => {
      $(id).addEventListener('input', sumCounts);
    });

    // first run
    sumCounts();
  </script>
</body>
</html>
